<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.51" />

    
    
    

<title>Python and VTK scientific visualisation • Nikola Stoyanov</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python and VTK scientific visualisation"/>
<meta name="twitter:description" content="Background CrackVis is a visualisation tool which uses VTK to display a point cloud from ABAQUS 2D simulations. The input is a csv file which holds data in the following format:
   X Y Z1 Z2 &hellip;     &hellip; &hellip; &hellip; &hellip; &hellip;    Where \(X\) and \(Y\) are the coordinates of the nodes and \(Z_n\) is the data to be investigated."/>

<meta property="og:title" content="Python and VTK scientific visualisation" />
<meta property="og:description" content="Background CrackVis is a visualisation tool which uses VTK to display a point cloud from ABAQUS 2D simulations. The input is a csv file which holds data in the following format:
   X Y Z1 Z2 &hellip;     &hellip; &hellip; &hellip; &hellip; &hellip;    Where \(X\) and \(Y\) are the coordinates of the nodes and \(Z_n\) is the data to be investigated." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niksto.net/posts/crackvis/" /><meta property="article:published_time" content="2018-06-06T00:00:00&#43;01:00"/>
<meta property="article:modified_time" content="2018-06-06T00:00:00&#43;01:00"/><meta property="og:site_name" content="Title" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">
    


    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://niksto.net/">Nikola Stoyanov</a>
      </span>
      
      <p class="site__description">
         Personal Website 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Nikola Stoyanov</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Home</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Portfolio</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/nikola3141" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/NikStoyanov" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/nikola-stoyanov-73709676" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	<a href="mailto:nikst@posteo.net" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    <div class="copyright">
  &copy; 2018 Nikola Stoyanov.
  <br/>
  <a href="https://creativecommons.org/licenses/by-sa/4.0">Some Rights Reserved</a>.
  
</div>

  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Python and VTK scientific visualisation</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 6, 2018
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/visualisation">VISUALISATION</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/python">python</a>
           
      
          <a class="badge badge-tag" href="/tags/vtk">vtk</a>
           
      
          <a class="badge badge-tag" href="/tags/crack">crack</a>
           
      
          <a class="badge badge-tag" href="/tags/femn">femn</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    

<h2 id="background">Background</h2>

<p>CrackVis is a visualisation tool which uses <a href="https://www.vtk.org/">VTK</a> to display a point
cloud from <a href="http://www.simulia.com/">ABAQUS</a> 2D simulations. The input is a csv file which holds
data in the following format:</p>

<table>
<thead>
<tr>
<th>X</th>
<th>Y</th>
<th>Z1</th>
<th>Z2</th>
<th>&hellip;</th>
</tr>
</thead>

<tbody>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
</tbody>
</table>

<p>Where \(X\) and \(Y\) are the coordinates of the nodes and \(Z_n\) is the
data to be investigated.</p>

<p>The tool will plot the point cloud which represents the nodal values
and add a scalar bar. I had to write my own parser scripts to extract
data from an ABAQUS .odb file to post-process other simulations,
however, I re-purposed them for this case. The code can be found in
<a href="https://github.com/NikStoyanov/phdfunc">this repository</a>. Feel free to modify for your own cases, the use of
the tool is independent of the data you are plotting.</p>

<h2 id="objective">Objective</h2>

<p>The purpose of the script is to provide a visual perspective on the
stress distribution of structural elements which can facilitate the
seed of cohesive elements to model crack initiation and propagation.</p>

<p>This is useful to consider when we are speaking of predefined crack
paths i.e. we do not allow arbitrary propagation.</p>

<h2 id="usage">Usage</h2>

<p>To use the tool you need to import the CrackVis module, provide the
file name and set user defined properties.</p>

<p>The properties are:</p>

<ul>
<li>Scaling factor: otherwise the plot will be difficult to perceive in some cases.</li>
<li>Feature: the column of the \(Z_n\) which is under investigation.</li>
<li>Point size.</li>
</ul>

<p>This is a trail and error approach to make the plot fit your needs.
If there is a better ways to do this let me know ¯\_(ツ)_/¯.</p>

<h2 id="example">Example</h2>

<p>Lets do an example! A simulation with ABAQUS has been ran on a plate
with the following boundary conditions:</p>

<ul>
<li>\(U_1 = U_2 = 0\) on West.</li>
<li>\(+F_1\) on East.</li>
<li>A quadratic temperature function was applied with 0°C on the
boundary and -160°C in the centre.</li>
</ul>

<p>They are quite unrealistic but good enough for a test case. A
schematic is shown below.</p>

<figure>
    <img src="/img/crackvis_schem.png" width="100%" height="100%"/> 
</figure>


<p>Lets first import the crackvis module.</p>

<pre><code class="language-python">from crackvis import VtkPointCloud, SetVtkWindow
</code></pre>

<p>Then we define the user variables with the file we want to plot. In
this case we are looking at the principal stress i.e. column 7 in our
export file with a point size of 10 and we scale the values by \(10^8\).</p>

<pre><code class="language-python">filename = &quot;./data/2D_Crack_Vis_m160C_200MPa.dat&quot;
scale = 10**8
feature = 7
point_size = 10
</code></pre>

<p>Finally, lets load the points in our <strong>VtkPointCloud</strong> object and the
window using <strong>SetVtkWindow</strong>.</p>

<pre><code class="language-python">point_cloud = VtkPointCloud(filename, scale, feature, point_size)
point_cloud.load_data()
vtk_window = SetVtkWindow(point_cloud)
</code></pre>

<p>We get this sweet 3D plot of the principal stress. Notice how
pronounced it is in the top/bottom edges of the boundary - it
definitely makes sense since some of the nodes in those finite
elements cannot move in x/y! This is good!</p>

<figure>
    <img src="/img/crackvis_pstress.png" width="100%" height="100%"/> 
</figure>


<p>Lets also code this for the temperature!</p>

<pre><code class="language-python">scale = 10**2
feature = 3
point_size = 10

# display the temperature
point_cloud = VtkPointCloud(filename, scale, feature, point_size)
point_cloud.load_data()
vtk_window = SetVtkWindow(point_cloud)
</code></pre>

<p>And we can see the quadratic temperature function applied in the FE calculation.</p>

<figure>
    <img src="/img/crackvis_temp.png" width="100%" height="100%"/> 
</figure>


<h2 id="vtk-scalar-bar-widget">VTK Scalar Bar Widget</h2>

<p>An important part of this project which I need for my PhD is the
scalar bar. As every true scientist I had to add this.</p>

<p>The scalar bar implementation in VTK is based on building a lookup
table and defining the minimum and maximum values of the input. All of
this is done in the window interactor. Luckily, I already have this
from my point cloud class since the points themselves are in a
different interactor then the window.</p>

<p>So lets create our lookup table. Notice how the hue is set to reflect
true engineering notation, read as red=max, blue=min :)</p>

<pre><code class="language-python">self.lut = vtk.vtkLookupTable()
self.build_lut()


def build_lut(self):
    &quot;&quot;&quot;
    Creates the lookup table
    Returns:
        - lut (vtkLookupTable): lookup table with red=max, blue=min
    &quot;&quot;&quot;

    self.lut.SetHueRange(0.667, 0)
    self.lut.Build()
</code></pre>

<p>Then lets build the vtk mapper for the points, this will later be
shared in the window actor where the scalar bar resides.</p>

<pre><code class="language-python">self.mapper = vtk.vtkPolyDataMapper()
self.mapper.SetInputData(self.vtkPolyData)
self.mapper.SetColorModeToDefault()
self.mapper.SetScalarVisibility(1)
self.mapper.SetLookupTable(self.lut)

# create the actor
self.vtkActor = vtk.vtkActor()
self.vtkActor.SetMapper(self.mapper)
</code></pre>

<p>When the file is loaded we extract the minimum and maximum values with
numpy and pass those to the mapper to render the colours correctly.</p>

<pre><code class="language-python">def set_range(self):
    &quot;&quot;&quot;
    Sets the scalar range in z
    &quot;&quot;&quot;

    self.mapper.SetScalarRange(self.min_data, self.max_data)
</code></pre>

<p>Finally, we need to create the scalar bar in the window. This happens
in <strong>SetVtkWindow</strong> and is a two stage process.</p>

<p>First we need to add the point cloud actor in the window
renderer. This will transfer the mapper as mentioned above. All of it
is achieved in the constructor when the window object is created.</p>

<pre><code class="language-python">renderer = vtk.vtkRenderer()
renderer.AddActor(point_cloud.vtkActor)
</code></pre>

<p>Then, we can build the scalar bar actor and the widget. They will
inherit the hue and the scalar range we have set in the point cloud
mapper.</p>

<pre><code class="language-python">scalar_bar = vtk.vtkScalarBarActor()
scalar_bar.SetOrientationToHorizontal()
scalar_bar.SetLookupTable(point_cloud.lut)
scalar_bar_widget = vtk.vtkScalarBarWidget()
scalar_bar_widget.SetInteractor(renderWindowInteractor)
scalar_bar_widget.SetScalarBarActor(scalar_bar)
scalar_bar_widget.On()
</code></pre>

<p>Voilà we have a scalar bar!</p>

<h2 id="full-code">Full Code</h2>

<p>Lets also see how the full code works. Below is the code from my
<a href="https://github.com/NikStoyanov/CrackVis">repository</a> and provided by <a href="https://gist-it.appspot.com/">gist-it</a>.</p>

<div class="HTML">
  <div></div>

<script src="<https://gist-it.appspot.com/https://github.com/NikStoyanov/CrackVis/blob/master/crackvis.py>"></script>

<p></div></p>

<p>The code consists of two classes:</p>

<ul>
<li><strong>VtkPointCloud</strong>: builds the point cloud by reading the data file and
adding each point. It also sets the vtk mapper for the scalar bar.</li>
<li><strong>SetVtkWindow</strong>: builds the window, renders the content of the point
cloud and adds the scalar bar.</li>
</ul>

<p>The reason for the split in two classes is because I wanted to handle
the window separately and add more functionality in the
future. Currently only point clouds are supported since it suits my
purposes for the moment, however, I would need to eventually render
the surface and connect some points of interest to determine the seed
path. But this is work for another day!</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/emacs_config/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Emacs Configuration File</span>
    </a>
    
    
    <a href="/posts/exploring_fractals/" class="navigation-next">
      <span class="navigation-tittle">Exploring Fractals</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-129217636-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ipython.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c&#43;&#43;.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["ipython, python, c, c++, shell"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
